{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanguerrero/sedee-proxy/pages/api/_utils.js"],"sourcesContent":["export function requireKey(req) {\n  const expected = process.env.PROXY_KEY;\n  if (!expected) return;\n  const key = req.headers[\"x-proxy-key\"] || req.query.key;\n  if (key !== expected) {\n    const err = new Error(\"Unauthorized\");\n    err.statusCode = 401;\n    throw err;\n  }\n}\n\nfunction deepOmit(obj, keysToRemove = new Set([\"password\", \"refreshToken\"])) {\n  if (obj === null || obj === undefined) return obj;\n  if (Array.isArray(obj)) return obj.map((v) => deepOmit(v, keysToRemove));\n  if (typeof obj === \"object\") {\n    const out = {};\n    for (const [k, v] of Object.entries(obj)) {\n      if (keysToRemove.has(k)) continue;\n      out[k] = deepOmit(v, keysToRemove);\n    }\n    return out;\n  }\n  return obj;\n}\n\nexport function sanitizeJson(data) {\n  return deepOmit(data);\n}\n\nexport async function forward(req, res, path) {\n  requireKey(req);\n\n  const base = process.env.SEDEE_API_BASE || \"https://api.sedee.io\";\n  const token = process.env.SEDEE_BEARER_TOKEN;\n\n  if (!token) {\n    return res.status(500).json({ error: \"Missing SEDEE_BEARER_TOKEN env var\" });\n  }\n\n  const url = new URL(base + path);\n  for (const [k, v] of Object.entries(req.query)) {\n    if (k === \"key\") continue;\n    if (v !== undefined) url.searchParams.set(k, String(v));\n  }\n\n  const upstream = await fetch(url.toString(), {\n    method: \"GET\",\n    headers: {\n      \"Authorization\": `Bearer ${token}`,\n      \"Accept\": \"application/json\",\n    },\n  });\n\n  const text = await upstream.text();\n  let body;\n  try {\n    body = text ? JSON.parse(text) : null;\n  } catch {\n    body = { raw: text };\n  }\n\n  if (body && typeof body === \"object\") body = sanitizeJson(body);\n\n  return res.status(upstream.status).json(body);\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,WAAW,GAAG;IAC5B,MAAM,WAAW,QAAQ,GAAG,CAAC,SAAS;IACtC,IAAI,CAAC,UAAU;IACf,MAAM,MAAM,IAAI,OAAO,CAAC,cAAc,IAAI,IAAI,KAAK,CAAC,GAAG;IACvD,IAAI,QAAQ,UAAU;QACpB,MAAM,MAAM,IAAI,MAAM;QACtB,IAAI,UAAU,GAAG;QACjB,MAAM;IACR;AACF;AAEA,SAAS,SAAS,GAAG,EAAE,eAAe,IAAI,IAAI;IAAC;IAAY;CAAe,CAAC;IACzE,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO;IAC9C,IAAI,MAAM,OAAO,CAAC,MAAM,OAAO,IAAI,GAAG,CAAC,CAAC,IAAM,SAAS,GAAG;IAC1D,IAAI,OAAO,QAAQ,UAAU;QAC3B,MAAM,MAAM,CAAC;QACb,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,OAAO,OAAO,CAAC,KAAM;YACxC,IAAI,aAAa,GAAG,CAAC,IAAI;YACzB,GAAG,CAAC,EAAE,GAAG,SAAS,GAAG;QACvB;QACA,OAAO;IACT;IACA,OAAO;AACT;AAEO,SAAS,aAAa,IAAI;IAC/B,OAAO,SAAS;AAClB;AAEO,eAAe,QAAQ,GAAG,EAAE,GAAG,EAAE,IAAI;IAC1C,WAAW;IAEX,MAAM,OAAO,QAAQ,GAAG,CAAC,cAAc,IAAI;IAC3C,MAAM,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;IAE5C,IAAI,CAAC,OAAO;QACV,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqC;IAC5E;IAEA,MAAM,MAAM,IAAI,IAAI,OAAO;IAC3B,KAAK,MAAM,CAAC,GAAG,EAAE,IAAI,OAAO,OAAO,CAAC,IAAI,KAAK,EAAG;QAC9C,IAAI,MAAM,OAAO;QACjB,IAAI,MAAM,WAAW,IAAI,YAAY,CAAC,GAAG,CAAC,GAAG,OAAO;IACtD;IAEA,MAAM,WAAW,MAAM,MAAM,IAAI,QAAQ,IAAI;QAC3C,QAAQ;QACR,SAAS;YACP,iBAAiB,CAAC,OAAO,EAAE,OAAO;YAClC,UAAU;QACZ;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAChC,IAAI;IACJ,IAAI;QACF,OAAO,OAAO,KAAK,KAAK,CAAC,QAAQ;IACnC,EAAE,OAAM;QACN,OAAO;YAAE,KAAK;QAAK;IACrB;IAEA,IAAI,QAAQ,OAAO,SAAS,UAAU,OAAO,aAAa;IAE1D,OAAO,IAAI,MAAM,CAAC,SAAS,MAAM,EAAE,IAAI,CAAC;AAC1C"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///Users/ivanguerrero/sedee-proxy/pages/api/chat_conversation_by_booking.js"],"sourcesContent":["import { forward } from \"./_utils\";\n\nexport default async function handler(req, res) {\n  const bookingId = req.query.bookingId;\n  if (!bookingId) return res.status(400).json({ error: \"Missing bookingId\" });\n\n  return forward(req, res, `/api/chat/conversations/booking/${bookingId}`);\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,YAAY,IAAI,KAAK,CAAC,SAAS;IACrC,IAAI,CAAC,WAAW,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAoB;IAEzE,OAAO,IAAA,0HAAO,EAAC,KAAK,KAAK,CAAC,gCAAgC,EAAE,WAAW;AACzE"}}]
}